{% extends "base.html.jinja" %}

{% from "stats/attachment_macros.html.jinja" import attachment_macro %}
{% from "stats/fire_group_macros.html.jinja" import fire_group_macro %}
{% from "stats/ammo_macros.html.jinja" import ammo_macro %}
{% from "stats/heat_macros.html.jinja" import heat_macro %}
{% from "stats/direct_damage_profile_macros.html.jinja" import direct_damage_profile_macro %}
{% from "stats/indirect_damage_profile_macros.html.jinja" import indirect_damage_profile_macro %}
{% from "stats/projectile_macros.html.jinja" import projectile_macro %}
{% from "stats/lock_on_macros.html.jinja" import lock_on_macro %}
{% from "stats/fire_timing_macros.html.jinja" import fire_timing_macro %}
{% from "stats/recoil_macros.html.jinja" import recoil_macro %}
{% from "stats/cone_of_fire_macros.html.jinja" import cone_of_fire_macro %}

{% block title %}{{ weapon.name }} stats{% endblock %}

{% block breadcrumb %}
    <nav class="breadcrumb" aria-label="breadcrumbs">
        <ul>
            <li><a href="/index.html">Home</a></li>
            <li><a href="/stats.html">Stats</a></li>
            <li><a href="/stats/infantry-weapons.html">Infantry weapons</a></li>
            <li class="is-active">
                <a href="/stats/infantry-weapons/{{ weapon.slug }}.html" aria-current="page">
                    {{ weapon.name }}
                </a>
            </li>
        </ul>
    </nav>
{% endblock %}

{% block content %}
    {% if weapon.image_path %}
        <figure class="image">
            <img
                src="https://census.daybreakgames.com{{ weapon.image_path }}"
                width="256"
                height="128"
                style="max-width: 100%; width: auto"
            />
        </figure>
    {% endif %}

    <p class="title is-1">{{ weapon.name }}</p>

    {% if weapon.description %}
        <p class="subtitle is-4">{{ weapon.description }}</p>
    {% endif %}

    <aside class="menu">
        <ul class="menu-list">
            <li><a href="#basic-information" class="has-text-link">Basic information</a></li>
            {% if weapon.fire_groups %}
                <li>
                    <a href="#fire-groups" class="has-text-link">Fire groups</a>
                    <ul>
                        {% for fire_group in weapon.fire_groups %}
                            <li>
                                <a href="#fire-group-{{ fire_group.fire_group_id }}" class="has-text-link">
                                    {{ fire_group.description }}
                                </a>
                                <ul>
                                    {% for fire_mode in fire_group.fire_modes %}
                                        <li>
                                            <a href="#fire-mode-{{ fire_mode.fire_mode_id }}" class="has-text-link">
                                                {{ fire_mode.fire_mode_type|enum_name }} {{ "ADS" if fire_mode.is_ads is true else "Hipfire" }}
                                            </a>
                                        </li>
                                    {% endfor %}
                                </ul>
                            </li>
                        {% endfor %}
                    </ul>
                </li>
            {% endif %}
            {% if weapon.attachments %}
                <li>
                    <a href="#attachments" class="has-text-link">Attachments</a>
                    <ul>
                        {% for attachment in weapon.attachments %}
                            <li>
                                <a href="#attachment-{{ attachment.attachment_item_id }}" class="has-text-link">
                                    {{ attachment.name }}{{ " (default)" if attachment.is_default is true else "" }}
                                </a>
                                {% if attachment.fire_groups %}
                                    <ul>
                                        {% for fire_group in attachment.fire_groups %}
                                            <li>
                                                <a href="#fire-group-{{fire_group.fire_group_id }}" class="has-text-link">
                                                    {{ fire_group.description }}
                                                </a>
                                                <ul>
                                                    {% for fire_mode in fire_group.fire_modes %}
                                                        <li>
                                                            <a href="#fire-mode-{{ fire_mode.fire_mode_id }}" class="has-text-link">
                                                                {{ fire_mode.fire_mode_type|enum_name }}
                                                            </a>
                                                        </li>
                                                    {% endfor %}
                                                </ul>
                                            </li>
                                        {% endfor %}
                                    </ul>
                                {% endif %}
                            </li>
                        {% endfor %}
                    </ul>
                </li>
            {% endif %}
        </ul>
    </aside>

    <br />

    <div class="content">
        <p class="title is-2" id="basic-information">Basic information</p>

        <table class="is-table">
            <tbody>
                <tr>
                    <th>Item / weapon ID</th>
                    <td>{{ weapon.item_id }} / {{ weapon.weapon_id }}</td>
                </tr>
                <tr>
                    <th>Faction</th>
                    <td>{{ weapon.faction|enum_name }}</td>
                </tr>
                <tr>
                    <th>Category</th>
                    <td>{{ weapon.category|enum_name }}</td>
                </tr>
                <tr>
                    <th>Move / turn multiplier</th>
                    <td>{{ weapon.move_multiplier }}x / {{ weapon.turn_multiplier }}x</td>
                </tr>
                <tr>
                    <th>Equip / unequip time</th>
                    <td>{{ weapon.equip_time}}ms / {{ weapon.unequip_time }}ms</td>
                </tr>
                <tr>
                    <th>To / from ADS time</th>
                    <td>{{ weapon.to_ads_time }}ms / {{ weapon.from_ads_time }}ms</td>
                </tr>
                <tr>
                    <th>Sprint recovery time</th>
                    <td>
                        {% if weapon.sprint_recovery_time %}
                            {{ weapon.sprint_recovery_time }}ms
                        {% else %}
                            Instant
                        {% endif %}
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    {% if weapon.fire_groups %}
        <div class="content">
            <p class="title is-2" id="fire-groups">Fire groups</p>

            <div class="columns is-multiline">
                <div class="column is-full">

                    {% if weapon.ammo and weapon.ammo.ammo_per_shot > 0 %}
                        {% set fire_group_ammo = false %}
                        {{ ammo_macro(ammo=weapon.ammo) }}
                    {% else %}
                        {% set fire_group_ammo = true %}
                    {% endif %}

                    {% if weapon.heat and weapon.heat.heat_per_shot > 0 %}
                        {% set fire_group_heat = false %}
                        {{ heat_macro(heat=weapon.heat) }}
                    {% else %}
                        {% set fire_group_heat = true %}
                    {% endif %}

                    {% if weapon.direct_damage_profile %}
                        {% set fire_group_direct_damage_profile = false %}
                        {{ direct_damage_profile_macro(direct=weapon.direct_damage_profile) }}
                    {% else %}
                        {% set fire_group_direct_damage_profile = true %}
                    {% endif %}

                    {% if weapon.indirect_damage_profile %}
                        {% set fire_group_indirect_damage_profile = false %}
                        {{ indirect_damage_profile_macro(indirect=weapon.indirect_damage_profile) }}
                    {% else %}
                        {% set fire_group_indirect_damage_profile = true %}
                    {% endif %}

                    {% if weapon.projectile %}
                        {% set fire_group_projectile = false %}
                        {{ projectile_macro(projectile=weapon.projectile) }}
                    {% else %}
                        {% set fire_group_projectile = true %}
                    {% endif %}

                    {% if weapon.lock_on %}
                        {% set fire_group_lock_on = false %}
                        {{ lock_on_macro(lock_on=weapon.lock_on) }}
                    {% else %}
                        {% set fire_group_lock_on = true %}
                    {% endif %}

                    {% if weapon.fire_timing %}
                        {% set fire_group_timing = false %}
                        {{ fire_timing_macro(timing=weapon.fire_timing) }}
                    {% else %}
                        {% set fire_group_timing = true %}
                    {% endif %}

                    {% if weapon.recoil %}
                        {% set fire_group_recoil = false %}
                        {{ recoil_macro(recoil=weapon.recoil) }}
                    {% else %}
                        {% set fire_group_recoil = true %}
                    {% endif %}

                    {% if weapon.player_state_cone_of_fire %}
                        {% set fire_group_player_state_cone_of_fire = false %}
                        <div class="box">
                            <p class="title is-5">Cone of fire</p>

                            {% for player_state, cone_of_fire in weapon.player_state_cone_of_fire|items %}
                                {{ cone_of_fire_macro(player_state=player_state, cone_of_fire=cone_of_fire) }}
                            {% endfor %}
                        </div>
                    {% else %}
                        {% set fire_group_player_state_cone_of_fire = true %}
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="content">
            <div class="columns is-multiline">
                {% for fire_group in weapon.fire_groups %}
                    {{ fire_group_macro(
                        fire_group=fire_group,
                        fire_group_background_classes=fire_group_background_classes,
                        fire_mode_background_classes=fire_mode_background_classes,
                        _loop=loop,
                        with_magdump_simulation=with_magdump_simulation,
                        with_ammo=fire_group_ammo,
                        with_heat=fire_group_heat,
                        with_direct_damage_profile=fire_group_direct_damage_profile,
                        with_indirect_damage_profile=fire_group_indirect_damage_profile,
                        with_projectile=fire_group_projectile,
                        with_lock_on=fire_group_lock_on,
                        with_timing=fire_group_timing,
                        with_recoil=fire_group_recoil,
                        with_player_state_cone_of_fire=fire_group_player_state_cone_of_fire
                    ) }}
                {% endfor %}
            </div>
        </div>
    {% endif %}

    {% if weapon.attachments %}
        <div class = "content">
            <p class="title is-2" id="attachments">Attachments</p>

            <div class="columns is-multiline">
                <div class="column is-full">
                    {% for attachment in weapon.attachments %}
                        {{ attachment_macro(
                            attachment=attachment,
                            fire_group_background_classes=fire_group_background_classes,
                            fire_mode_background_classes=fire_mode_background_classes,
                            _loop=loop
                        ) }}
                    {% endfor %}
                </div>
            </div>
        </div>
    {% endif %}
{% endblock %}
